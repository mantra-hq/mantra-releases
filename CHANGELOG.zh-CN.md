# Mantra - 更新日志

[English](./CHANGELOG.md) | **中文**

**Mantra** 是一个本地优先的 AI 编程会话"时光机"。它将 AI 对话日志（来自 Claude Code、Cursor、Gemini CLI 等工具）与 Git 历史对齐在统一时间轴上，帮助开发者回放上下文，理解代码变更背后的"为什么"。

---

## [v0.8.0] - 2026-02-09

### 新增

- **应用自动更新系统 (Epic 14)**:
    - **Tauri 更新插件集成**: 配置 `tauri-plugin-updater`，完成签名密钥验证和更新端点接入 (Story 14.1, 14.2)。
    - **Cloudflare Worker 更新端点**: 部署 Cloudflare Worker 从公开发布仓库提供更新元数据 (Story 14.3)。
    - **CI/CD 更新产物**: 扩展 `release.yml` 和 `publish-public.yml`，支持全平台 updater 签名产物（`.sig`、`.app.tar.gz`）的构建、签名和发布 (Story 14.4)。
    - **useUpdateChecker Hook**: 实现 React Hook，支持自动检查更新（每 24 小时）、静默后台下载和重启安装 (Story 14.5)。
    - **设置页「关于与更新」区域**: 在通用设置页添加版本号展示和手动检查更新，包含下载进度和重启按钮 (Story 14.7)。
    - **轻量化更新 UX（VS Code 风格）**: 更新就绪时在设置按钮上显示徽标提醒；自动检查开关持久化到 localStorage；更新日志以外部链接打开 (Story 14.10)。
    - **国际化**: 新增 `updater` 命名空间的中英双语翻译 (Story 14.8)。
    - **端到端验证**: 完成全链路更新流程的跨平台验证 (Story 14.9)。

- **设置页重构**:
    - **嵌套路由**: 将设置页重构为侧边栏导航，包含通用、开发和隐私三个子页面。
    - **工具配置路径管理**: 新增 AI 工具自定义配置路径管理界面（Claude Code、Cursor 等）。

- **会话播放器**:
    - **SkillRenderer**: 新增技能/命令调用详情渲染组件，展示名称、参数和执行结果。
    - **PrivacyPledge**: 在播放器空状态页添加隐私承诺展示。

- **MCP 增强**:
    - **自定义配置路径解析**: 支持用户自定义 MCP 工具扫描和接管的配置目录路径。

- **单实例运行**: 集成 `tauri-plugin-single-instance`，防止应用重复启动；再次启动时自动聚焦已有窗口。

### 变更

- **设置页布局**: 采用 VS Code 风格的居中内容布局，提升阅读体验。
- **CI/CD**: 改进发布工作流中的版本字符串处理（基于 awk 的 changelog 提取）。
- **品牌统一**: 将所有界面文本、系统托盘菜单、Tooltip 和国际化翻译中的 "Gateway" 统一更名为 "MCP Hub"。
- **应用图标**: 为应用图标添加约 10% 的透明边距，使其在 macOS/Windows/Linux 中与其他应用视觉大小一致；托盘图标使用独立的无边距图标以保持小尺寸下的清晰度。

### 修复

- **系统托盘状态同步**: 修复托盘状态从未刷新的问题，根因是创建托盘时未指定 ID（`TrayIconBuilder::new()` → `TrayIconBuilder::with_id("main")`）。启动/停止/重启 MCP Hub 时正确同步托盘状态。
- **系统托盘精简**: 移除托盘菜单中的「切换项目」子菜单。

## [v0.7.0] - 2026-02-06

### 新增

- **MCP Gateway (Epic 11)**:
    - **SSE Server 核心**: 实现嵌入式 Axum SSE Server，支持 JSON-RPC 协议通信 (Story 11.1)。
    - **MCP 服务数据模型**: 基于 SQLite 实现 MCP 服务的 CRUD 操作与状态管理 (Story 11.2)。
    - **配置导入与智能接管**: 支持从 Claude Code、Cursor、Gemini CLI、Codex 一键导入 MCP 配置，包含冲突差异对比和影子模式预览 (Story 11.3, 11.13)。
    - **环境变量管理**: 集中管理 API Key 等敏感信息，支持加密存储和跨服务引用检测 (Story 11.4)。
    - **上下文路由**: 实现最长前缀匹配 (LPM) 路由算法，根据项目上下文自动选择对应的 MCP 服务 (Story 11.5)。
    - **Mantra Hub 管理界面**: 全新的 Hub 页面，集成 Gateway 状态卡片、MCP 服务列表、服务表单、环境变量管理器和项目关联功能 (Story 11.6)。
    - **系统托盘集成**: 支持系统托盘快捷操作，包含项目切换和 Gateway 状态管理 (Story 11.7)。
    - **架构重构 (ADR-001)**: 采用模块化适配器模式，支持 Claude、Gemini、Cursor、Codex 四种工具配置适配 (Story 11.8)。
    - **项目详情 MCP 集成**: 在项目详情页嵌入 MCP 管理入口，支持项目级服务关联与状态查看 (Story 11.9)。
    - **工具粒度管理**: 实现 ToolPolicy 模型，支持全局和服务级别的工具权限控制与 Gateway 拦截 (Story 11.10)。
    - **内置 MCP Inspector**: 集成调试器，包含 ToolExplorer、ToolTester 和 RpcLogViewer 组件 (Story 11.11)。
    - **远程 MCP OAuth 支持**: 支持 Google Drive、Slack 等远程 MCP 服务的 OAuth 认证流程 (Story 11.12)。
    - **Streamable HTTP 合规**: 遵循 MCP Streamable HTTP 规范 (2025-03-26)，统一 `/mcp` 端点，添加 Origin 验证和 Session Header (Story 11.14)。
    - **智能接管合并引擎**: 三档分类（新增/更新/冲突）+ 来源追踪 + 冲突决策 (Story 11.19)。
    - **全工具自动接管**: 全工具分组预览 + 工具勾选 + 事务性接管 (Story 11.20)。
    - **Claude Local Scope 支持**: 完整支持 Claude Code 的本地作用域配置 (Story 11.21)。
    - **原子性备份恢复**: 实现备份完整性校验和原子性操作，保留最近 5 个版本 + 自动清理 (Story 11.22, 11.23)。
    - **MCP Roots 机制**: 实现 MCP Roots 协议和 LPM 集成，支持项目级配置感知 (Story 11.26, 11.27)。
    - **严格模式服务过滤**: 基于项目上下文的服务过滤，确保仅暴露相关服务 (Story 11.28)。
    - **导入后自动关联**: 配置导入完成后自动引导用户关联项目，支持名称匹配和并行关联 (Story 11.29)。

- **UX 交互一致性优化 (Epic 12)**:
    - **Dialog → Sheet 迁移**: 将非确认类 Dialog 统一迁移为 Sheet（侧边抽屉），包括 ProjectInfo、McpConfigImport、EditMessage、EnvVariable、OAuthConfig 等组件 (Story 12.1 ~ 12.4)。
    - **ActionSheet 统一封装**: 引入 ActionSheet 统一封装组件，规范弹出层交互模式 (Story 12.4)。
    - **工具权限 UX 优化**: 优化工具权限管理入口，提升操作清晰度和一致性 (Story 12.5)。

- **数据库**: 引入轻量级数据库连接方法，优化查询性能 (Story 11.2)。

### 变更

- **MCP 架构**: 重构 MCP 命令结构和 Gateway 启动逻辑，统一配置写入流程。
- **UI 组件**: 全面统一 Dialog 尺寸规范，提升响应式和可用性。
- **国际化**: 更新中英文翻译，覆盖备份管理、OAuth、工具策略等新增功能。

### 修复

- **MCP**: 修复服务切换时配置处理问题、工具选择初始化逻辑和项目级配置文件清理 (Story 11.25)。
- **Hub**: 修复 ToolPolicyEditor 布局一致性问题和 TakeoverStatusCard 测试实现。
- **Gateway**: 修复 SSE 流中 roots/list 请求的处理问题和 Gateway 重启行为。

## [v0.6.0] - 2026-01-25

### 新增

- **项目管理 (Epic 1)**:
    - **基于视图的聚合**: 实现存储层（原始导入结构）与视图层（按物理路径聚合的逻辑项目）分离的双层架构，使来自不同 AI 工具（Claude、Gemini、Cursor）的会话统一到同一工作区 (Story 1.12)。
    - **逻辑项目重命名**: 支持为逻辑项目设置自定义显示名称，独立于导入时的项目名存储 (Story 1.13)。
    - **改进项目识别**: 增强路径存在性和类型（本地、虚拟、远程）的检测，更好地管理"待关联"状态。
    - **取消关联**: 支持将特定源项目从聚合的逻辑项目中取消关联。

- **IDE 支持**: 扩展了对更多 IDE 配置和环境的支持。

- **文档**: 集成 Gemini CLI 上下文文档以增强 Agent 辅助。

### 修复

- **UI/UX**:
    - 修复 TopBar 会话列表和项目名称在关联后未立即更新的同步问题。
    - 修复关联路径为 Git 仓库子目录时文件树的显示问题。
    - 补充项目重命名和取消关联操作的 i18n 翻译。

- **打包**:
    - 修复 RPM 构建问题。
    - 完善发布工作流中的发布文档。

## [v0.5.2] - 2026-01-22

### 修复

- **UI/UX**: 修复 UI 溢出问题并改进项目路径处理。

### 维护

- **文档**: Story 8.19 审查后状态更新为完成。

## [v0.5.1] - 2026-01-22

### 变更

- **发布**: 更新客户端版本至 v0.5.1。

## [v0.5.0] - 2026-01-20

### 新增

- **模式切换 (Epic 10)**:
    - **精简模式**: 引入全新的"精炼"（Compact）模式用于会话上下文优化，帮助用户聚焦核心信息。
    - **模式切换 UI**: 在 TopBar 中集成无缝模式切换器 (Story 10.11, 10.1)。
    - **键盘快捷键**: 支持全局键盘快捷键切换模式和执行操作 (Story 10.10)。
    - **撤销/重做栈**: 为会话编辑操作实现健壮的撤销/重做功能 (Story 10.8)。
    - **编辑状态持久化**: 确保编辑状态在模式切换时保持不变 (Story 10.9)。

- **会话管理增强**:
    - **Token 统计**: 实时 Token 使用统计和计算 (Story 10.6)。
    - **消息插入**: 支持在会话叙事中插入新消息，改进 UI/UX (Story 10.5)。
    - **消息标注**: 支持消息标注功能 (Story 10.4)。
    - **压缩预览**: 引入实时消息优化预览组件 (Story 10.3)。
    - **导出功能**: 支持导出会话，包括处理后/精炼后的会话 (Story 10.7)。

### 修复

- **Bug 修复**: 代码审查中发现并修复了 Story 10.4、10.5、10.7、10.8、10.9、10.10 的多项问题。

## [v0.4.0] - 2026-01-10

### 新增

- **隐私与安全 (Epic 3)**:
    - **隐私保护模块**: 实现处理敏感信息的综合模块。
    - **自定义检测规则**: 添加自定义隐私检测规则的管理界面 (Story 3.10)。
    - **Pre-Tool Use 检测**: 实现 `PreToolUse` 文件内容检测，在工具执行前防止敏感数据泄漏 (Story 3.11)。
    - **拦截记录**: 添加隐私拦截记录的存储和专用查看页面 (Story 3.7, 3.8)。
    - **上传前隐私检查**: 在会话上传前集成隐私检查 (Story 3.9)。

- **项目分析 (Epic 2)**:
    - **项目分析**: 完成项目分析统计功能的实现 (Story 2.34)。
    - **全局搜索增强**: 增强全局搜索，支持筛选器和分组结果 (Story 2.33)。
    - **子模块支持**: 增强 FileTree 组件中的 Git 子模块支持 (Story 2.31)。

- **测试与质量 (Epic 9)**:
    - **视觉回归测试**: 实现视觉回归测试框架 (Story 9.5)。
    - **核心 E2E 测试**: 为关键用户流程添加核心端到端测试 (Story 9.4)。
    - **IPC Mock**: 实现 IPC Mock 层以支持可靠的 E2E 测试 (Story 9.2)。

- **解析器增强 (Epic 8)**:
    - **Cursor 解析器**: 完成 Cursor 日志的增强和工具映射 (Story 8.17)。
    - **图片支持**: 支持会话中的图片内容块 (Story 8.16)。
    - **弹性增强**: 增强解析器弹性并添加格式兼容性监控 (Story 8.15)。
    - **前端适配**: 完成前端组件适配，包括 FileEdit Diff 视图集成 (Story 8.11)。
    - **标准化**: 将解析器重构为统一目录结构 (Story 8.14) 并增强数据模型 (Story 8.1)。

### 变更

- **重构**: 重构隐私 Hook 架构。
- **文档**: 更新 Claude Code Hook 插件和隐私功能的文档。


## [v0.3.0] - 2025-12-30

### 新增

- **隐私脱敏 (Epic 3)**:
  - **Rust 正则引擎**: 实现基于正则的高性能脱敏引擎 (Story 3.1)。
  - **自定义规则**: 支持用户自定义脱敏规则 (Story 3.3)。
  - **差异预览**: 实现脱敏内容的并排差异预览 (Story 3.2, 3.4)。
  - **规则矩阵**: 添加全面的脱敏规则测试矩阵。

- **项目管理 (Epic 2)**:
  - **多源聚合**: 统一展示来自不同来源（Claude、Cursor、Gemini）的项目 (Story 2.25)。
  - **项目抽屉**: 实现可折叠的项目抽屉以改善导航 (Story 2.18)。
  - **项目信息**: 添加查看项目详细元数据的对话框 (Story 2.27)。
  - **空状态处理**: 改进空项目/会话的处理和过滤 (Story 2.29)。
  - **一键复制**: 为消息和日志添加一键复制功能 (Story 2.22, 2.28)。

- **导入体验**:
  - **增强向导**: 添加实时进度反馈和取消支持 (Story 2.20, 2.23)。
  - **智能识别**: 使用 Git remote URL 改进项目识别 (Story 1.9)。
  - **Gemini 支持**: 完整支持导入和解析 Gemini CLI 日志 (Story 1.6)。

- **国际化 (i18n)**:
  - **完整支持**: 完成所有核心组件的 i18n 实现 (Story 2.26)。
  - **双语**: 支持英文和简体中文。

### 变更

- **UX 改进**:
  - **TopBar**: 重构 TopBar 以改善导航和模式切换 (Story 2.17)。
  - **反馈**: 统一用户反馈机制（Toast 通知）。
  - **视觉**: 更新来源图标和项目树动画。
  - **仪表盘**: 移除仪表盘，适当情况下直接进入播放器视图 (Story 2.21)。

## [v0.2.0] - 2025-12-15

### 新增

- **会话导航 (Epic 2)**:
  - **消息过滤**: 支持按类型过滤会话消息 (Story 2.16)。
  - **详情面板**: 实现可折叠的消息检查详情面板 (Story 2.15)。
  - **历史 UX**: 改进历史状态导航的用户体验 (Story 2.14)。
  - **面包屑**: 添加面包屑导航 (Story 2.17)。

- **代码浏览**:
  - **文件浏览器**: 实现多标签页文件浏览器 (Story 2.13)。
  - **智能选择**: 添加初始文件选择的智能逻辑 (Story 2.12)。
  - **Git 关联**: 将初始代码状态与 Git 仓库关联 (Story 2.11)。
  - **全局搜索**: 实现跨会话和内容的全局搜索 (Story 2.10)。

- **解析器 (Epic 1)**:
  - **Cursor 支持**: 初步支持 Cursor 会话日志解析 (Story 1.7)。

- **核心组件**:
  - **TimberLine**: 实现会话回放的时间轴控制器 (Story 2.6)。
  - **CodeSnapshot**: 添加特定时间点的代码快照展示视图 (Story 2.5)。

### 变更

- **字体**: 集成 JetBrains Mono 以提升代码可读性。
- **布局**: 优化分栏布局和自适应高度。

## [v0.1.0] - 2025-12-01

### 新增

- **首次发布**:
  - **Tauri v2 初始化**: 基于 Tauri v2 和 React 19 初始化项目 (Story 1.1)。
  - **设计系统**: 实现基础设计系统和主题配置 (Story 2.1)。
  - **双流布局**: 并排叙事与代码视图的核心布局引擎 (Story 2.2)。
  - **叙事流**: 渲染聊天历史的组件 (Story 2.3)。
  - **消息气泡**: 不同消息类型的基础组件 (Story 2.4)。
  - **时光旅行**: 基础 Git 时光旅行服务实现 (Story 1.4, 2.7)。
  - **项目扫描器**: 扫描和聚合本地项目的服务 (Story 1.5)。
  - **仪表盘**: 项目列表的初始仪表盘 (Story 2.8)。
  - **导入 UI**: 导入会话日志的基础 UI (Story 2.9)。
  - **Claude 解析器**: Claude Code JSONL 日志的初始解析器 (Story 1.3)。
